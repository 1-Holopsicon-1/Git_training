<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>

    {% load static %}
    <title>Title</title>
</head>
<body>
    {% if notPassed %}
        <form name="form" method="POST" id="form-main">
            {% csrf_token %}

            {% if survey.creator != None %}
            <label>Creator: </label>
            <a href="{% url 'user_info' %}?user={{ survey.creator.username }}">{{survey.creator.username}}</a>
            {% else %}
            <label>Creator was deleted</label>
            {% endif %}
            <br>
            {% if survey.creator.username == request.user.username %}
                {% if survey.isLocked %}
                    <input id="lock_btn" type="submit" value="Unlock">
                {% else %}
                    <input id="lock_btn" type="submit" value="Lock">
                {% endif %}
            {% endif %}
            <br>
            <label>{{survey.title}}</label>
            <br>
            <label>{{survey.description}}</label>
            <br>

            {% for question, answer_group, index in answers %}
            <label>{{question.text}}</label>
            <br>
            {% for answer in answer_group %}
                {% if question.multipleChoice %}
                    <input name="answers_inp{{index}}" type="checkbox" id="answer_{{index}}_{{answer.text}}" value="{{answer.text}}" oninput="check()">
                {% else %}
                    <input name="answers_inp{{index}}" type="radio" id="answer_{{index}}_{{answer.text}}" value="{{answer.text}}" oninput="check()">
                {% endif %}
                <label>{{ answer.text }}</label>
                <br>
            {% endfor %}
            {% endfor %}

            <input id="vote_btn" type="submit" value="Vote" disabled>
        </form>
    {% else %}
    
        {% if survey.creator != None %}
        <label>Creator: </label>
        <a href="{% url 'user_info' %}?user={{ survey.creator.username }}">{{survey.creator.username}}</a>
        {% else %}
        <label>Creator was deleted</label>
        {% endif %}
        <br>

        <form name="form" method="POST" id="form-lock">
            {% csrf_token %}
            {% if survey.creator.username == request.user.username %}
                {% if survey.isLocked %}
                    <input id="lock_btn" type="submit" value="Unlock">
                {% else %}
                    <input id="lock_btn" type="submit" value="Lock">
                {% endif %}
            {% endif %}
        </form>
        <br>
        <label>{{survey.title}}</label>
        <br>
        <label>{{survey.description}}</label>
        <br>
        {% for question, answer_group in answers %}
            <p></p>
            <label>{{question.text}}</label>
            <br>
            {% for answer in answer_group %}
                {% for elem in answer %}
                    <label>{{ elem }}</label>
                {% endfor %}
                <br>
            {% endfor %}
        {% endfor %}
    {% endif %}

    {% if survey.creator.username == request.user.username and not old %}
        <a href="{% url 'survey_edit' %}?survey={{survey.url}}"><input type="button" value="Edit"></a>
    {% endif %}

    <form id="form-rating" method="POST">
        {% csrf_token %}
        
        {% if rated == 1 %}
            <input id="like_btn" type="submit" value="Like ({{ survey.upped.count }})" style="background-color: rgb(50, 255, 50);">
        {% else %}
            <input id="like_btn" type="submit" value="Like ({{ survey.upped.count }})" style="background-color: white;">
        {% endif %}


        {% if rated == -1 %}
            <input id="dislike_btn" type="submit" value="Dislike ({{ survey.downed.count }})" style="background-color: rgb(255, 50, 50);">
        {% else %}
            <input id="dislike_btn" type="submit" value="Dislike ({{ survey.downed.count }})" style="background-color: white;">
        {% endif %}
    </form>
    <p></p>
    <div id="div_messages">
    </div>

    <h5>Comments</h5>
    <div>
        {% for comment, childComments in comments %}
        <a href="{% url 'user_info' %}?user={{ comment.user.username }}">{{comment.user.username}}</a>
        <label>{{ comment.creationTime|date:"H:i d.m.Y" }}</label><br>
        <label>{{ comment.text }}</label>
        {% for comment_ in childComments %}
        <p></p>
        <a href="{% url 'user_info' %}?user={{ comment.user.username }}" style="margin-left: 50px;">{{comment_.user.username}}</a>
        <label>{{ comment_.creationTime|date:"H:i d.m.Y" }}</label>
        <label style="color: dimgray;">in reply to {{ comment_.parentComment.user.username }}</label>
        <br>
        <label style="margin-left: 50px;">{{ comment_.text }}</label>
        {% endfor %}
        <p></p>
        {% endfor %}
    </div>

    {% include 'menu.html' %}
    
    <script src="{% static 'js/surveyVotingAjax.js' %}"></script>
</body>
</html>